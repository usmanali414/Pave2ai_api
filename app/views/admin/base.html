<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Admin{% endblock %}</title>
    <style>
      :root {
        /* Purple theme inspired by provided design */
        --bg: #f5f6fb;
        --card: #ffffff;
        --muted: #7c8aa0;
        --primary: #6c5ce7;          /* base purple */
        --primary-strong: #5a4bd6;   /* hover */
        --border: #e9edf5;
        --text: #1f2937;
        --sidebar: #6c5ce7;          /* purple sidebar */
        --sidebar-text: #eef2ff;
      }
      html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text); }
      .layout { display: grid; grid-template-columns: 240px 1fr; grid-template-rows: 56px 1fr; min-height: 100%; background: var(--bg); }
      .sidebar { grid-row: 1 / span 2; background: var(--sidebar); color: var(--sidebar-text); padding: 16px 12px; }
      .brand { display: flex; align-items: center; height: 56px; font-weight: 700; font-size: 16px; letter-spacing: 0.3px; }
      .nav { margin-top: 12px; }
      .nav a { display: flex; align-items: center; color: var(--sidebar-text); text-decoration: none; padding: 10px 12px; border-radius: 10px; font-size: 14px; }
      .nav a:hover { background: rgba(255,255,255,0.18); }
      .nav .nav-parent { display: flex; align-items: center; justify-content: space-between; }
      .nav .caret { margin-left: 8px; opacity: 0.8; }
      .submenu { display: none; margin: 4px 0 0 8px; }
      .submenu.show { display: block; }
      .submenu a { font-size: 13px; padding: 8px 12px; }
      .header { grid-column: 2; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: var(--card); border-bottom: 1px solid var(--border); }
      .main { grid-column: 2; padding: 20px; }
      .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
      .muted { color: var(--muted); }
      .btn { display: inline-flex; align-items: center; gap: 8px; height: 36px; padding: 0 12px; border: 1px solid var(--border); border-radius: 10px; background: #fff; color: var(--text); cursor: pointer; box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
      .btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 6px 14px rgba(108,92,231,0.25); }
      .btn.primary:hover { background: var(--primary-strong); }
      .btn:disabled { opacity: .6; cursor: not-allowed; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; }
      a.btn { text-decoration: none; }
      .toast { position: fixed; top: 16px; right: 16px; background: #111827; color: #fff; padding: 10px 12px; border-radius: 12px; box-shadow: 0 12px 35px rgba(0,0,0,0.18); opacity: 0; pointer-events: none; transform: translateY(-8px); transition: opacity .2s ease, transform .2s ease; z-index: 10001; }
      .toast.show { opacity: 1; pointer-events: auto; transform: translateY(0); }
      .toast.success { background: #059669; }
      .toast.error { background: #dc2626; }
      /* Modal */
      .backdrop { position: fixed; inset: 0; background: rgba(17,24,39,0.55); display: none; align-items: center; justify-content: center; z-index: 10000; backdrop-filter: blur(2px); }
      .backdrop.show { display: flex; }
      .modal { width: 100%; max-width: 640px; background: var(--card); border: 1px solid var(--border); border-radius: 14px; box-shadow: 0 24px 60px rgba(92,81,199,0.25); }
      .modal header { padding: 14px 16px; border-bottom: 1px solid var(--border); font-weight: 600; }
      .modal .body { padding: 16px; }
      .modal .footer { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
      .field { margin-bottom: 10px; }
      .field label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
      .field input, .field select, .field textarea { width: 100%; height: 36px; padding: 0 12px; border: 1px solid var(--border); border-radius: 10px; box-sizing: border-box; background: #fff; }
      .field textarea { height: auto; padding: 10px; }
      /* Table aesthetics */
      table { background: var(--card); border: 1px solid var(--border); border-radius: 12px; }
      thead th { background: #f8f9ff; }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body>
    <div id="toast" class="toast"></div>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">Admin Panel</div>
        <nav class="nav">
          <a href="/admin/dashboard">Dashboard</a>
          <div>
            <a href="/admin/customers" class="nav-parent" onclick="toggleCms(event)">Customer Management <span class="caret">▾</span></a>
            <div id="cm-submenu" class="submenu">
              <a id="cm-tenants" href="/admin/customers?tab=users&sub=tenants">Tenants</a>
              <a id="cm-users" href="/admin/customers?tab=users&sub=users">Users</a>
            </div>
          </div>
          <div>
            <a href="/admin/projects" class="nav-parent" onclick="togglePm(event)">Project Management <span class="caret">▾</span></a>
            <div id="pm-submenu" class="submenu">
              <a id="pm-projects" href="/admin/projects?sub=projects">Projects</a>
              <a id="pm-settings" href="/admin/project-settings?sub=settings">Project Settings</a>
            </div>
          </div>
          <div>
            <a href="/admin/train-settings" class="nav-parent" onclick="toggleTm(event)">Train Settings <span class="caret">▾</span></a>
            <div id="tm-submenu" class="submenu">
              <a id="tm-create" href="/admin/train-settings?sub=create">Create Configurations</a>
              <a id="tm-train" href="/admin/train-settings?sub=train">Training</a>
            </div>
          </div>
        </nav>
      </aside>
      <header class="header">
        <div>Admin</div>
        <div class="muted">Signed in</div>
      </header>
      <main class="main">
        {% block content %}{% endblock %}
      </main>
    </div>
    <script>
      (function(){
        function showToast(message, type){
          var el = document.getElementById('toast');
          el.textContent = message;
          el.className = 'toast show ' + (type || '');
          setTimeout(function(){ el.className = 'toast'; }, 3000);
        }
        window.showToast = showToast;
        try {
          var params = new URLSearchParams(window.location.search);
          var msg = params.get('toast') || params.get('success') || params.get('error');
          if (msg) {
            var type = params.get('type') || (params.has('error') ? 'error' : 'success');
            showToast(decodeURIComponent(msg), type);
            // Remove toast params so refresh doesn't replay the toast
            ['toast','success','error','type'].forEach(function(k){ params.delete(k); });
            var newSearch = params.toString();
            var newUrl = location.pathname + (newSearch ? ('?' + newSearch) : '');
            history.replaceState(null, '', newUrl);
          }
        } catch(e) {}
        window.openModal = function(id){ var b = document.getElementById(id); if (b) b.classList.add('show'); };
        window.closeModal = function(id){
          var b = document.getElementById(id);
          if (b && b.parentNode) { b.parentNode.removeChild(b); }
        };
        window.toggleCms = function(event){
          event.preventDefault();
          var sm = document.getElementById('cm-submenu');
          if (sm) { sm.classList.toggle('show'); }
          var href = event.currentTarget && event.currentTarget.getAttribute('href');
          if (href) { history.replaceState(null, '', href); }
        };
        window.togglePm = function(event){
          event.preventDefault();
          var sm = document.getElementById('pm-submenu');
          if (sm) { sm.classList.toggle('show'); }
          var href = event.currentTarget && event.currentTarget.getAttribute('href');
          if (href) { history.replaceState(null, '', href); }
        };
        window.toggleTm = function(event){
          event.preventDefault();
          var sm = document.getElementById('tm-submenu');
          if (sm) { sm.classList.toggle('show'); }
          var href = event.currentTarget && event.currentTarget.getAttribute('href');
          if (href) { history.replaceState(null, '', href + '?sub=create'); }
        };
        // Auto-expand submenu and set active item
        try {
          var path = location.pathname;
          if (path.startsWith('/admin/customers')) {
            var sm = document.getElementById('cm-submenu');
            if (sm) sm.classList.add('show');
            var p = new URLSearchParams(location.search);
            var sub = p.get('sub');
            var tab = p.get('tab');
            if (tab === 'users') {
              if (sub === 'users') {
                var u = document.getElementById('cm-users'); if (u) u.classList.add('primary');
              } else {
                var t = document.getElementById('cm-tenants'); if (t) t.classList.add('primary');
              }
            }
          }
          if (path.startsWith('/admin/projects') || path.startsWith('/admin/project-settings')) {
            var sm = document.getElementById('pm-submenu');
            if (sm) sm.classList.add('show');
            if (path.startsWith('/admin/project-settings')) {
              var s = document.getElementById('pm-settings');
              if (s) s.classList.add('primary');
            } else {
              var p = document.getElementById('pm-projects');
              if (p) p.classList.add('primary');
            }
          }
          if (path.startsWith('/admin/train-settings')) {
            var sm2 = document.getElementById('tm-submenu');
            if (sm2) sm2.classList.add('show');
            var p2 = new URLSearchParams(location.search);
            var sub2 = p2.get('sub');
            if (sub2 === 'train') { var t2 = document.getElementById('tm-train'); if (t2) t2.classList.add('primary'); }
            else { var c2 = document.getElementById('tm-create'); if (c2) c2.classList.add('primary'); }
          }
        } catch(e) {}
      })();
    </script>
  </body>
  </html>


